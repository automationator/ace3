#           _____ ______ 
#     /\   / ____|  ____|
#    /  \ | |    | |__   
#   / /\ \| |    |  __|  
#  / ____ \ |____| |____ 
# /_/    \_\_____|______|
#                        
# Alert Correlation Engine
#
# unittest configuration
#

global:
  company_name: default
  company_id: 1
  instance_name: local1
  node: localhost
  instance_type: UNITTEST
  error_reporting_email: ace@localhost
  local_domains:
    - localdomain
  local_email_domains: 
    - localdomain
    - company.com
  fp_days: 0
  data_dir: data_unittest
  log_sql: false

monitor:
  use_stdout: false
  use_stderr: false
  use_logging: false
  use_cache: false

network_configuration:
  managed_networks:
    - 10.0.0.0/8
    - 172.16.0.0/12
    - 192.168.0.0/16

SSL:
  ca_chain_path: ssl/ca-chain.cert.pem

SLA:
  enabled: false
  time_to_dispo: 4

SLA_dlp:
  property: alert_type
  value: dlp-exit-alert
  time_to_dispo: 36

#proxy:
  #transport: ""
  #host: ""
  #port: ""
  #user: ""
  #password: ""

api:
  ssl_cert: ssl/ace.cert.pem
  ssl_key: ssl/ace.key.pem
  # listen on a different port since apache already has 443 taken (most likely)
  listen_port: 24443
  prefix: localhost:24443
  api_key: dcef0db0-556f-44b3-9e1b-3d97b435d264

gui:
  ssl_cert: ssl/ace.cert.pem
  ssl_key: ssl/ace.key.pem
  base_uri: https://localhost:5000/ace
  default_company_id: 1
  core_companies: 
    - 1

client:
  uri: ""

cloudphish:
  cache_dir: cloudphish_unittest

# database connections
# NOTE: keep password values as strings to preserve env: reference
# unix_socket left empty matches default behavior

database_ace:
  hostname: ace-db
  unix_socket: ""
  database: ace-unittest
  username: ace-user
  password: "env:ACE_DB_PASSWORD"

database_collection:
  hostname: ace-db
  unix_socket: ""
  database: ace-unittest
  username: ace-user
  password: "env:ACE_DB_PASSWORD"

database_brocess:
  hostname: ace-db
  unix_socket: ""
  database: brocess-unittest
  username: ace-user
  password: "env:ACE_DB_PASSWORD"

database_email_archive:
  hostname: ace-db
  unix_socket: ""
  database: email-archive-unittest
  username: ace-user
  password: "env:ACE_DB_PASSWORD"

analysis_module_basic_test:
  name: basic_test
  python_module: saq.modules.test
  python_class: BasicTestAnalyzer
  enabled: false

analysis_module_generic_test:
  name: generic_test
  python_module: saq.modules.test
  python_class: GenericTestAnalyzer
  enabled: false

analysis_module_configurable_module_test:
  name: configurable_module_test
  python_module: saq.modules.test
  python_class: ConfigurableModuleTestAnalyzer
  enabled: false
  valid_observable_types: [ipv4,test]
  required_directives: [archive]
  required_tags: [test]

analysis_module_dependency_test:
  name: dependency_test
  python_module: saq.modules.test
  python_class: DependencyTestAnalyzer
  enabled: false

analysis_module_test_delayed_analysis:
  name: test_delayed_analysis
  python_module: saq.modules.test
  python_class: DelayedAnalysisTestModule
  enabled: false

analysis_module_test_delayed_analysis_instance:
  name: test_delayed_analysis_instance
  python_module: saq.modules.test
  python_class: DelayedAnalysisTestModule
  enabled: false
  instance: instance1

analysis_module_test_engine_locking:
  name: test_engine_locking
  python_module: saq.modules.test
  python_class: EngineLockingTestModule
  enabled: false

analysis_module_test_final_analysis:
  name: test_final_analysis
  python_module: saq.modules.test
  python_class: FinalAnalysisTestAnalyzer
  enabled: false

analysis_module_test_post_analysis:
  name: test_post_analysis
  python_module: saq.modules.test
  python_class: PostAnalysisTest
  enabled: false

analysis_module_test_delayed_analysis_timeout:
  name: test_delayed_analysis_timeout
  python_module: saq.modules.test
  python_class: DelayedAnalysisTimeoutTest
  enabled: false

analysis_module_test_wait_a:
  name: test_wait_a
  python_module: saq.modules.test
  python_class: WaitAnalyzerModule_A
  enabled: false
  priority: 9

analysis_module_test_wait_a_instance:
  name: test_wait_a_instance
  python_module: saq.modules.test
  python_class: WaitAnalyzerModule_A
  enabled: false
  instance: instance1
  priority: 9

analysis_module_test_wait_a_instance_2:
  name: test_wait_a_instance_2
  python_module: saq.modules.test
  python_class: WaitAnalyzerModule_A
  enabled: false
  instance: instance2

analysis_module_test_wait_b:
  name: test_wait_b
  python_module: saq.modules.test
  python_class: WaitAnalyzerModule_B
  enabled: false

analysis_module_test_wait_b_instance:
  name: test_wait_b_instance
  python_module: saq.modules.test
  python_class: WaitAnalyzerModule_B
  enabled: false
  instance: instance1

analysis_module_test_wait_c:
  name: test_wait_c
  python_module: saq.modules.test
  python_class: WaitAnalyzerModule_C
  enabled: false

analysis_module_merge_test:
  name: merge_test
  python_module: saq.modules.test
  python_class: MergeTestAnalyzer
  enabled: false

#analysis_module_threaded_test:
  #name: threaded_test
  #python_module: saq.modules.test
  #python_class: ThreadedModuleTest
  #enabled: false
  #threaded: true
  #threaded_execution_frequency: 1

#analysis_module_threaded_test_broken:
  #name: threaded_test_broken
  #python_module: saq.modules.test
  #python_class: BrokenThreadedModuleTest
  #enabled: false
  #threaded: true
  #threaded_execution_frequency: 1

analysis_module_cloudphish_delayed_test:
  name: cloudphish_delayed_test
  python_module: saq.modules.test
  python_class: CloudphishDelayedTestAnalyzer
  enabled: false

analysis_module_forced_detection:
  name: forced_detection
  python_module: saq.modules.test
  python_class: ForcedDetectionTestAnalyzer
  enabled: false

analysis_module_low_priority:
  name: low_priority
  python_module: saq.modules.test
  python_class: LowPriorityAnalyzer
  enabled: false
  priority: 20

analysis_module_high_priority:
  name: high_priority
  python_module: saq.modules.test
  python_class: HighPriorityAnalyzer
  enabled: false
  priority: 0

analysis_module_generate_file:
  name: generate_file
  python_module: saq.modules.test
  python_class: GenerateFileAnalyzer
  enabled: false
  priority: 0

analysis_module_no_priority:
  name: no_priority
  python_module: saq.modules.test
  python_class: NoPriorityAnalyzer
  enabled: false

analysis_module_test_file_size_limit:
  name: test_file_size_limit
  python_module: saq.modules.test
  python_class: FileSizeLimitAnalyzer
  enabled: false
  file_size_limit: 2

analysis_module_post_analysis_multi_mode:
  name: post_analysis_multi_mode
  python_module: saq.modules.test
  python_class: PostAnalysisMultiModeTest
  enabled: false

analysis_module_grouped_time_range:
  name: grouped_time_range
  python_module: saq.modules.test
  python_class: GroupedByTimeRangeAnalyzer
  enabled: false
  observation_grouping_time_range: "00:10:00"

analysis_module_grouping_target:
  name: grouping_target
  python_module: saq.modules.test
  python_class: GroupingTargetAnalyzer
  enabled: false
  observation_grouping_time_range: "00:10:00"

analysis_module_pause:
  name: pause
  python_module: saq.modules.test
  python_class: PauseAnalyzer
  enabled: false

analysis_module_instance_1:
  name: instance_1
  python_module: saq.modules.test
  python_class: TestInstanceAnalyzer
  instance: instance1
  enabled: false
  sql: "SELECT * FROM whatever"

analysis_module_instance_2:
  name: instance_2
  python_module: saq.modules.test
  python_class: TestInstanceAnalyzer
  instance: instance2
  enabled: false
  sql: "SELECT * FROM thatonething"

#analysis_module_analysis_cache_test:
  #name: analysis_cache_test
  #python_module: saq.modules.test
  #python_class: CacheTestAnalyzer
  #enabled: false
  #cache: true

analysis_module_valid_queues_test:
  name: valid_queues_test
  python_module: saq.modules.test
  python_class: ValidQueueAnalyzer
  enabled: false
  valid_queues: [test]

analysis_module_invalid_queues_test:
  name: invalid_queues_test
  python_module: saq.modules.test
  python_class: InvalidQueueAnalyzer
  enabled: false
  invalid_queues: [test]

analysis_module_bad_summary_test:
  name: bad_summary_test
  python_module: saq.modules.test
  python_class: BadSummaryTestAnalyzer
  enabled: false

analysis_module_netbios_analyzer:
  enabled: true
  ssh_host: ""

analysis_module_dns_analyzer:
  ssh_host: ""

#analysis_module_cloudphish:
  #cloudphish.1: localhost:24443

analysis_module_crawlphish:
  whitelist_path: etc/unittest_crawlphish.whitelist
  regex_path: etc/unittest_crawlphish.path_regex
  blacklist_path: etc/unittest_crawlphish.blacklist
  proxies: []

#analysis_module_api_analysis_test:
  #name: api_analysis_test
  #module: tests.saq.test_api_analysis
  #class: StubAPIAnalyzer
  #enabled: true
  #api: analysis_module_api_analysis_test
  #instance: TestAPIAnalyzer
  #wide_duration_before: "03:00:00:00"
  #wide_duration_after: "00:30:00"
  #narrow_duration_before: "01:00:00"
  #narrow_duration_after: "01:00:00"
  #max_result_count: 10
  #query_timeout: 3
  #question: "Does this module work?"
  #summary: "This will let us know if this module working."
  #query: "SELECT * FROM items WHERE type = <O_VALUE> and time > <O_START> and time < <O_STOP>"
  #map_any: "color = any"

#analysis_module_api_analysis_multi_value_test:
  #name: api_analysis_multi_value_test
  #module: tests.saq.test_api_analysis
  #class: StubAPIMultiValueAnalyzer
  #enabled: true
  #api: analysis_module_api_analysis_multi_value_test
  #instance: TestAPIAnalyzer
  #wide_duration_before: "03:00:00:00"
  #wide_duration_after: "00:30:00"
  #narrow_duration_before: "01:00:00"
  #narrow_duration_after: "01:00:00"
  #max_result_count: 10
  #query_timeout: 3
  #question: "Does this module work?"
  #summary: "This will let us know if this module working."
  #query: "SELECT * FROM items WHERE color = <O_VALUE1> OR color = <O_VALUE2> OR color = <O_VALUE3> and time > <O_START> and time < <O_STOP>"
  #map_any: "color = any"

#analysis_module_api_analysis_timeout_test:
  #name: api_analysis_timeout_test
  #module: tests.saq.test_api_analysis
  #class: StubAPITimeoutAnalyzer
  #enabled: true
  #api: analysis_module_api_analysis_test
  #instance: TestAPIAnalyzer
  #wide_duration_before: "03:00:00:00"
  #wide_duration_after: "00:30:00"
  #narrow_duration_before: "01:00:00"
  #narrow_duration_after: "01:00:00"
  #max_result_count: 10
  #query_timeout: 0
  #question: "Does this module work?"
  #summary: "This will let us know if this module working."
  #query: "SELECT * FROM items WHERE type = <O_VALUE> and time > <O_START> and time < <O_STOP>"
  #map_any: "color = any"

module_group_unittest:
  name: unittest
  modules:
    - basic_test
    - configurable_module_test
    - dependency_test
    - generate_file
    - generic_test
    - grouped_time_range
    - grouping_target
    - high_priority
    - instance_1
    - instance_2
    - low_priority
    - merge_test
    - no_priority
    - pause
    - post_analysis_multi_mode
    - test_delayed_analysis
    - test_delayed_analysis_instance
    - test_delayed_analysis_timeout
    - test_engine_locking
    - test_final_analysis
    - test_post_analysis
    - test_wait_a
    - test_wait_a_instance
    - test_wait_a_instance_2
    - test_wait_b
    - test_wait_b_instance
    - test_wait_c
    #- threaded_test
    #- threaded_test_broken
    - bad_summary_test
    - test_file_size_limit

module_group_queues:
  name: queues
  modules:
    - basic_test
    - valid_queues_test
    - invalid_queues_test

#module_group_cache:
  #name: cache
  #modules:
    #- analysis_cache_test

service_network_semaphore:
  bind_address: 127.0.0.1
  bind_port: 53560
  remote_address: 127.0.0.1
  remote_port: 53560

service_email_collector:
  enabled: true
  assignment_yara_rule_path: etc/remote_assignments.unittest.yar

smtp:
  server: localhost
  mail_from: ace@localhost

messaging_system_test:
  enabled: true
  module: saq.messaging.test
  class: TestMessageDispatchSystem
  route: test

message_routing:
  test: test:test_destination

ldap:
  ldap_server: localhost
  ldap_bind_user: user
  ldap_bind_password: password
  ldap_base_dn: domain
  top_user: theboss

service_engine:
  local_analysis_modes: 
    - test_empty
    - test_single
    - test_groups
    - test_disabled
    - test_cleanup
    - test_queues
    - test_cache
  default_analysis_mode: test_single
  pool_size_limit: 1

collection_group_default:
  name: default
  enabled: false
  coverage: 100
  full_delivery: true
  # NOTE this is what connects the collection_group to the nodes
  database: ace
  company_id: 1

collection_group_unittest:
  name: unittest
  enabled: true
  coverage: 100
  full_delivery: true
  database: ace
  company_id: 1
  target_nodes: [LOCAL]

collection_group_disabled:
  name: disabled
  enabled: false
  coverage: 100
  full_delivery: true
  database: ace
  company_id: 1

analysis_mode_test_empty:
  name: test_empty
  cleanup: false
  module_groups: []

analysis_mode_test_single:
  name: test_single
  cleanup: false
  module_groups: []
  enabled_modules:
    - basic_test

analysis_mode_test_groups:
  name: test_groups
  cleanup: false
  module_groups: [unittest]

analysis_mode_test_disabled:
  name: test_disabled
  cleanup: false
  module_groups: [unittest]
  disabled_modules:
    - basic_test

analysis_mode_test_cleanup:
  name: test_cleanup
  cleanup: true
  module_groups: []

analysis_mode_test_queues:
  name: test_queues
  cleanup: false
  module_groups: [queues]

#analysis_mode_test_cache:
  #name: test_cache
  #cleanup: false
  #module_groups: [cache]

remediator_test:
  name: test
  display_name: Test Remediator
  description: This is a test remediator.
  observable_type: test
  python_module: tests.saq.remediation.test_remediator
  python_class: TestRemediator
  thread_count: 1

  client_id: test
  tenant_id: test
  thumbprint: test
  private_key: test
  server: test
  version: test
  user: test
  pass: test

settings:
  refresh_seconds: 60

observable_expiration_mappings:
  # yes/no to set any observables expires_on value to Null (never expire) if the observable is inside an event
  # that has a threat actor assigned to it.
  #never_expire_with_threat_actor: true
  # Time deltas containing how long an observable has before expiring as a detection point
  # format: observable_type = DD:HH:MM:SS
  # If you want the observable type to never expire, simply remove it from this config section.
  ipv4: "14:00:00:00"

shodan:
  api_key: test

apikeys:
  # value is dcef0db0-556f-44b3-9e1b-3d97b435d264
  test: 46db99d06ab943eca3213089137fd6265b74df1e17bc201327db8b547be1c2b9

service_remediation:
  unchecked_types: []

api_query_defaults:
  - name: test_api
    wide_duration_before: "00:00:00:00"
    wide_duration_after: "00:00:00:00"
    narrow_duration_before: "00:00:00:00"
    narrow_duration_after: "00:00:00:00"
    max_result_count: 1
    query_timeout: 1
    async_delay: 1
    use_index_time: true

analysis_module_splunk_api:
  question: "Example question?"
  summary: "Example summary."
  name: splunk_api
  enabled: true
  python_module: saq.modules.splunk
  python_class: SplunkAPIAnalyzer
  api_name: test_api
  query: index=test
  wide_duration_before: "00:00:00:00"
  wide_duration_after: "00:00:00:00"
  narrow_duration_before: "00:00:00:00"
  narrow_duration_after: "00:00:00:00"
  max_result_count: 1
  query_timeout: 1
  async_delay: 1
  use_index_time: true

analysis_module_user_defined_tagging:
  priority: 1

test_api:
  timezone: UTC
  uri: https://www.test.com
  username: user
  password: pass

minio:
  access_key: ace3apitest
  secret_key: 5ad82077-e6bf-471d-8f44-979c4f541082

service_llm_embedding:
  enabled: false

email_archive:
  s3_bucket: ace-email-archive-test

api_query_defaults_test_api:
  name: test_api
  wide_duration_before: "01:00:00:00"
  wide_duration_after: "01:00:00:00"
  narrow_duration_before: "00:01:00:00"
  narrow_duration_after: "00:01:00:00"
  max_result_count: 1000
  query_timeout: 300
  # how long to wait between calls to check for status of an async query
  async_delay: 1
  use_index_time: true

splunk_config_default:
  name: default
  enabled: true
  host: localhost
  port: 443
  username:
  password:
  token:
  timezone: UTC
  performance_logging_dir: splunk_perf

splunk_config_test_api:
  name: test_api
  enabled: true
  host: localhost
  port: 443
  username:
  password:
  token:
  timezone: UTC
  performance_logging_dir: splunk_perf